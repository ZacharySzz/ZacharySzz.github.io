<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Spring中的动态代理 - 我的博客</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "\u57fa\u4e8e==\u63a5\u53e3==\u7684\u52a8\u6001\u4ee3\u7406", url: "#_top", children: [
          ]},
          {title: "\u57fa\u4e8e==\u5b50\u7c7b==\u7684\u52a8\u6001\u4ee3\u7406", url: "#_2", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../3%E3%80%81Spring%20AOP/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../3%E3%80%81Spring%20AOP/" class="btn btn-xs btn-link">
        Spring AOP
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1%E3%80%81Spring%20IOC%20%E4%B8%AD%E7%9A%84%E6%B3%A8%E8%A7%A3/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1%E3%80%81Spring%20IOC%20%E4%B8%AD%E7%9A%84%E6%B3%A8%E8%A7%A3/" class="btn btn-xs btn-link">
        Spring IOC 中的注解
      </a>
    </div>
    
  </div>

    

    <ul>
<li>
<p>动态代理：</p>
<ul>
<li>
<p>特点：字节码随用随创建，随用随加载</p>
</li>
<li>
<p>作用：不修改源码的基础上对方法增强</p>
</li>
<li>
<p>分类：</p>
<ol>
<li>
<p>基于接口的动态代理</p>
</li>
<li>
<p>基于子类的动态代理</p>
</li>
</ol>
</li>
<li>
<p><strong>基于==接口==的动态代理：</strong></p>
<blockquote>
<p>涉及的类：Proxy</p>
<p>提供者：JDK官方</p>
<p>如何创建代理对象：</p>
<p>​        使用Proxy类中的<code>newProxyInstance()</code>方法</p>
</blockquote>
<ul>
<li>创建代理对象的要求：</li>
</ul>
<p>被代理类最少实现一个接口，如果没有则不能使用</p>
<ul>
<li><code>newProxyInstance()</code>方法的参数：</li>
</ul>
<blockquote>
<p><code>ClassLoader</code>：类加载器</p>
<p>​      它是用于加载代理对象字节码的。和被代理对象使用相同的类加载器。固定写法。</p>
<p><code>Class[]</code>：字节码数组</p>
<p>​      它是用于让代理对象和被代理对象有相同方法。固定写法。</p>
<p><code>InvocationHandler</code>：用于提供增强的代码</p>
</blockquote>
</li>
<li>
<p><strong>基于==子类==的动态代理：</strong></p>
</li>
</ul>
<blockquote>
<p>涉及的类：Enhancer</p>
<p>提供者：第三方cglib库</p>
<p>如何创建代理对象：</p>
<p>​      使用Enhancer类中的<code>create()</code>方法</p>
</blockquote>
<ul>
<li>
<p>创建代理对象的要求：</p>
<p>被代理类不能是最终类</p>
</li>
<li>
<p><code>create()</code>方法的参数：</p>
<blockquote>
<p>Class：字节码</p>
<p>​        它是用于指定被代理对象的字节码。</p>
<p>Callback：用于提供增强的代码</p>
</blockquote>
</li>
</ul>
<p>它是让我们写如何代理。我们一般都是些一个该接口的实现类，通常情况下都是匿名内部类，但不是必须的。</p>
<p>==此接口的实现类都是谁用谁写。==</p>
</li>
</ul>
<h4 id="_1">基于==接口==的动态代理</h4>
<pre><code class="java">IProducer proxyProducer = (IProducer) Proxy.newProxyInstance(producer.getClass().getClassLoader(),producer.getClass().getInterfaces(),new InvocationHandler() {
    /**
    * 作用：执行被代理对象的任何接口方法都会经过该方法
    * 方法参数的含义
    * @param proxy   代理对象的引用
    * @param method  当前执行的方法
    * @param args    当前执行方法所需的参数
    * @return        和被代理对象方法有相同的返回值
    * @throws Throwable
    */
    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable{
        //提供增强的代码
        Object returnValue = null;

        //1.获取方法执行的参数
        Float money = (Float)args[0];
        //2.判断当前方法是不是销售
        if(&quot;saleProduct&quot;.equals(method.getName())) {
            returnValue = method.invoke(producer, money*0.8f);
        }
        return returnValue;
        }
});
</code></pre>

<h4 id="_2">基于==子类==的动态代理</h4>
<pre><code class="java">Producer cglibProducer = (Producer)Enhancer.create(producer.getClass(), new MethodInterceptor() {
    /**
    * 执行北地阿里对象的任何方法都会经过该方法
    * @param proxy
    * @param method
    * @param args
    *    以上三个参数和基于接口的动态代理中invoke方法的参数是一样的
    * @param methodProxy ：当前执行方法的代理对象
    * @return
    * @throws Throwable
    */
    @Override
    public Object intercept(Object proxy, Method method, Object[] args, MethodProxy methodProxy) throws Throwable {
        //提供增强的代码
        Object returnValue = null;

        //1.获取方法执行的参数
        Float money = (Float)args[0];
        //2.判断当前方法是不是销售
        if(&quot;saleProduct&quot;.equals(method.getName())) {
            returnValue = method.invoke(producer, money*0.8f);
        }
        return returnValue;
    }
});
cglibProducer.saleProduct(12000f);
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../3%E3%80%81Spring%20AOP/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../3%E3%80%81Spring%20AOP/" class="btn btn-xs btn-link">
        Spring AOP
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../1%E3%80%81Spring%20IOC%20%E4%B8%AD%E7%9A%84%E6%B3%A8%E8%A7%A3/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../1%E3%80%81Spring%20IOC%20%E4%B8%AD%E7%9A%84%E6%B3%A8%E8%A7%A3/" class="btn btn-xs btn-link">
        Spring IOC 中的注解
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>